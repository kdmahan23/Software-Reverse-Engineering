## Karson Mahan
# SRE Project 3 - Streams of Woe At Acheron
# SRE S20
------------------------------------------------
## Summary
You are provided a malware sample. Your job is to perform a complete analysis of this malware and write a thorough report of what actions it takes and how it performs those actions. While writing your report concentrate on why the sample performs certain actions and how those actions are performed.

----

Malware is a never-ending attack on our sensitive data, and with all this new technology the composition of malware changes quickly. The malware sample provided is just one of many examples of how these malicious attacks occur and infiltrate different systems. Malware can invade systems via email, malicious downloads, or actual invasion of a data system. Due to this we must analyze and record the changes, so that we can maintain a high level of security. In my research and analysis of the provided malware program I have made the following discoveries:

Analyzing the composition of the malware is the first and one of the most essential parts to learning how the malware infiltrates the target and what data the malware is trying to obtain. Once we can identify the language and method of attack of this malware, we can then start the analysis needed to strengthen our defenses. The malware was compiled in Microsoft Visual C++, this allows us to easily identify the methods that the malware is going to take. When further investigating the debugger in IDA, I discovered that the malware is targeting the browser history, passwords and usernames. The malware also pretends to be an updater for the Realtek Audio Driver v.1.3.2. By pretending to be this fake audio driver updater the malware can trick an unknowing party to open and run the code. 

I began the investigation into this malware by using the RegShot application. This application assisted me in figuring out if the malware modifies the registers or files on the target machine. When running RegShot for the first time, I focused on the registers and did not have RegShot scan any files. After running the malware, the first time, RegShot said there was a total of 42,625 changed made to the registers and 19,572 keys were deleted all within the HKLM directory. The keys deleted were deviceIDs, driver packages, Driver Inf files, and driver files within the driver database. There were 26 values added, two values were in HKLM system and the rest were located in HKU. There were 48 values modified within HKLM software, HKLM system and HKU. The second run of RegShot I scanned the entire C:/ drive to see what files were modified. This second run produced 42,610 total changes; this is less than the initial run of this software. There were two folders added, “ C:\Users\MyMac\AppData\Local\Packages\Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy\AC\Microsoft” and “C:\Users\MyMac\AppData\Local\Packages\Microsoft.Windows.Apprep.ChxApp_cw5n1h2txyewy\AC\Microsoft\Windows”. I also found that twenty file attributes had been modified: 

![](./img1.png)

There were four files added:

![](./img2.png)

There were also 17 files modified, this is far less than the initial run of the malware. The values were modified in HKLM software, HKLM system and HKU.

The second notable discovery is the method of encryption and intended target of this malware program. The malware uses Crypt32.dll library for its embedded encrypted strings. These strings are stored within the “.rdata” section; the most notable strings are the username and password variables. The intended target for this malware is the usernames, passwords and URLs of websites visited by the target. This malware also targets additional data, such as the OS, Path Variable, username of target machine, user domain, system root, and additional information about the target machine’s environment. The root key “HKLM-HKEY_LOCAL_MACHINE” is contained within the Windows registry. The HKU-HKEY_USERS contain subkeys corresponding to the HKEY_CURRENT_USER keys for each user profile actively loaded on the machine. The four min subkeys under HKLM are SAM, SECURITY, SOFTWARE, SYSTEM. The software contains the settings for Windows and the software programs installed on the computer. Once this software is installed, the data is then written to the SOFTWARE subkey in order to store application-specific settings. The system contains information about the Windows system setup, data for the secure random number generator (RNG), the list of currently mounted devices containing the filesystem, several numbered “HKL\SYSTEM\Control Sets” containing alternative configurations for system hardware drivers and services running on the local system (including the currently used services and a backup), a “HKLM\SYSTEM\Select” subkey containing the status of these Control Sets, and a “HKLM\SYSTEM\CurrentControlSet” which is dynamically linked at boot time to the Control Set which is currently used on the local system. 
Upon further investigation the malware stores a file within the decrypted strings, once this file has completed its intended process the program then deletes the existence of the file. This malware also uses IP address 23.120.187.172 and the port number 4433 in order to interact with external servers. Once this malware has infiltrated our system it begins its search and exfiltration method to acquire sensitive data. The malware then sends this exfiltrated data to an SQLite database. We are able to get the full output of what the malware exfiltrates by stopping the attack before the complete transfer of the file. By stopping at this point you will see the code that initiates the pull of the sensitive data. The malware also attempts to prevent the ability to reverse engineer by checking to see if a debugger is present; this occurs twice within the code. The malware also calls the command “NtQueryInformationProcess” as another method to prevent the code from being analyzed and reverse engineered.

In conclusion, this malware was created to infiltrate the targeted system in order to gain access to sensitive data. This sensitive data includes usernames, passwords and browser history. By the malware being written in C++ it was easy to debug and locate the embedded strings that sought to invade the targeted system. It begins its invasion by posing as the Realtek Audio Driver Updater, once the target downloads and installs this program the malware within begins its attack on the system. The malware then copies, modifies, edits and deletes different aspects of the targets local machine. The malware then uses the Crypt32.dll library for encryption, these strings are found in “. rdata”.  The malware then stores a file with the decrypted strings on the target. By doing this the malware is able to gather information on the OS, Path Variable, Username of target machine, user domain, and system root. Once the attack has completed, the malware then proceeds to delete the file that was housing the decrypted strings. The malware also uses the IP address 23.120.187.172 and port number 4433 to interact with any external servers. The malware then exfiltrates the data sending it to an SQLite database. One can acquire a full output of what the malware exfiltrates, but in order to do so one would need to stop the malware attack before completion of data transfer. In stopping this process, one is then able to see the code that is used to initiate the pull of the sensitive data. This malware has been a good example of how infectious and quickly this type of program works to target sensitive data within the targeted system. 

----



